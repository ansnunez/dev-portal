<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Difficulty Adjustment | Zilliqa Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Difficulty Adjustment | Zilliqa Developer Portal"><meta data-react-helmet="true" name="description" content="Zilliqa has a dynamic difficulty level adjustment mechanism. The goal of this mechanism is to adjust the difficulty level according to the number of PoW submissions received."><meta data-react-helmet="true" property="og:description" content="Zilliqa has a dynamic difficulty level adjustment mechanism. The goal of this mechanism is to adjust the difficulty level according to the number of PoW submissions received."><meta data-react-helmet="true" property="og:url" content="https://ansnunez.github.io/dev-portal/docs/core-difficulty-adjustment"><link data-react-helmet="true" rel="shortcut icon" href="/dev-portal/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://ansnunez.github.io/dev-portal/docs/core-difficulty-adjustment"><link rel="stylesheet" href="/dev-portal/styles.61ad20ac.css">
<link rel="preload" href="/dev-portal/styles.02de1ceb.js" as="script">
<link rel="preload" href="/dev-portal/runtime~main.8c9447a9.js" as="script">
<link rel="preload" href="/dev-portal/main.4f969add.js" as="script">
<link rel="preload" href="/dev-portal/1.4ed8170a.js" as="script">
<link rel="preload" href="/dev-portal/2.b4fff381.js" as="script">
<link rel="preload" href="/dev-portal/98.5ddf222f.js" as="script">
<link rel="preload" href="/dev-portal/99.16543845.js" as="script">
<link rel="preload" href="/dev-portal/242c3953.e8f65e58.js" as="script">
<link rel="preload" href="/dev-portal/17896441.2c23e411.js" as="script">
<link rel="preload" href="/dev-portal/8459df8b.bc0d9ea4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/dev-portal/"><img class="navbar__logo" src="/dev-portal/img/zilliqa-logo_1zilliqa-logo.png" alt="My Site Logo"><strong class="navbar__title">Zilliqa Developer Portal</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dev-portal/docs/">Basics</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dev-portal/docs/dev-started-introduction">Developers</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dev-portal/docs/mining-getting-started">Miners</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dev-portal/docs/exchange-getting-started">Exchanges</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/dev-portal/docs/contribute-buildzil">Contributors</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/dev-portal/"><img class="navbar__logo" src="/dev-portal/img/zilliqa-logo_1zilliqa-logo.png" alt="My Site Logo"><strong class="navbar__title">Zilliqa Developer Portal</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/dev-portal/docs/">Basics</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/dev-portal/docs/dev-started-introduction">Developers</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/dev-portal/docs/mining-getting-started">Miners</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/dev-portal/docs/exchange-getting-started">Exchanges</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/dev-portal/docs/contribute-buildzil">Contributors</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contributors</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/contribute-buildzil">Building Zilliqa</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/contribute-guidelines">Contribution Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/contribute-standards">Protocol Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/contribute-bug-bounty">Bug Bounty Program</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Core Protocol Design</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal/docs/core-intro">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Design Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-node-operation">General Node Operation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Consensus Layer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-consensus">Consensus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-multisignatures">Multisignatures</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Network Layer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-gossip">Gossip</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-broadcasting">Broadcasting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-blacklist">Blacklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-messaging-limits">Messaging Limits</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Messaging Layer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-message-dispatch">Message Dispatch and Processing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-message-queues">Message Queues and Jobs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Data Layer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-incremental-db">Incremental DB</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Directory Service</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-ds-mimo">DS MIMO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-ds-reputation">DS Reputation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Lookup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-websocket-server">WebSocket Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-transaction-dispatch">Transaction Dispatch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-multipliers">Multipliers</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Mining</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal/docs/core-pow">PoW Algorithm</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/dev-portal/docs/core-difficulty-adjustment">Difficulty Adjustment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal/docs/core-por">Proof of Reputation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dev-portal/docs/core-coinbase">Coinbase Rewards</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Mitigation Measures</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-guard-mode">Guard Mode</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-rejoin-mechanism">Rejoin Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-view-change">View Change</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-diagnostic-data">Diagnostic Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dev-portal/docs/core-status-server">Status Server</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Difficulty Adjustment</h1></header><div class="markdown"><p>Zilliqa has a dynamic difficulty level adjustment mechanism. The goal of this mechanism is to adjust the difficulty level according to the number of PoW submissions received.</p><p>When the network receives a low number of PoW submissions, the mechanism will reduce the difficulty so that more nodes can join and maintain the network. On the other hand, when the network receives a high number of PoW submissions, the mechanism will increase the difficulty level, making it harder for Sybil attacks to be executed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="adjustment-procedure"></a>Adjustment Procedure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adjustment-procedure" title="Direct link to heading">#</a></h2><ol><li>When we bootstrap the system, every node reads the initial difficulty level from <code>constants.xml</code>. After that, the nodes will update the difficulty level at the first transaction epoch of each DS epoch</li><li>At the beginning of each DS epoch, every DS node receives PoW submissions and records them. When the DS leader proposes the next DS block, it calls <code>CalculateNewDifficulty()</code> and <code>CalculateNewDSDifficulty()</code> to calculate the new difficulty levels. These difficulty levels are placed in the <code>m_dsDifficulty</code> and <code>m_difficulty</code> fields in the DS block. Finally, the DS leader announces the DS block to start the consensus</li><li>The DS backup nodes receive the announcement, and calculate the new difficulty by similarly calling <code>CalculateNewDifficulty()</code> and <code>CalculateNewDSDifficulty()</code> then comparing the results with those proposed by the DS leader</li><li>Once the DS committee completes consensus over the DS block containing the new difficulty level, the committee broadcasts the block to the shards. The shard nodes accept the new difficulty and use it to do PoW for the next DS epoch</li><li>New nodes that are not part of the network can get the latest difficulty from the lookup nodes by retrieving the latest DS block</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="adjustment-formula-and-parameters"></a>Adjustment Formula and Parameters<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adjustment-formula-and-parameters" title="Direct link to heading">#</a></h2><p>There are 4 parameters in <code>constants.xml</code> that are used to calculate the difficulty:</p><ul><li><code>POW_CHANGE_TO_ADJ_DIFF</code></li><li><code>POW_CHANGE_TO_ADJ_DS_DIFF</code></li><li><code>EXPECTED_SHARD_NODE_NUM</code></li><li><code>NUM_DS_ELECTION</code></li></ul><p>Additionally, there are two dynamic parameters that are used to calculate the difficulty:</p><ul><li>The number of shard PoW submissions</li><li>The number of DS PoW submissions</li></ul><p>The basic formulas used to calculate the new difficulty are:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-C++ codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">New shard difficulty = Current Difficulty + (Shard PoW Submissions - EXPECTED_SHARD_NODE_NUM) / POW_CHANGE_TO_ADJ_DIFF</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New DS difficulty = Current DS Difficulty + (DS PoW Submissions - NUM_DS_ELECTION) / POW_CHANGE_TO_ADJ_DS_DIFF</span></div></div></div></div></div><p>The rationale of the formulas is when there are more PoW submissions than the expected number, increase the difficulty. When there are less PoW submissions than the expected number, decrease the difficulty.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="difficulty-subdivision"></a>Difficulty Subdivision<a aria-hidden="true" tabindex="-1" class="hash-link" href="#difficulty-subdivision" title="Direct link to heading">#</a></h2><p>When the difficulty increases by one, the required hash power to finish PoW will be doubled. When the difficulty is already very high, adjusting the difficulty by doubling the hash power causes a lot of miners to fail to do PoW. This in turn affects the stability and throughput of the blockchain.</p><p>To address this situation, we added a threshold to <strong>subdivide</strong> the difficulty. There are two constant parameters <code>POW_BOUNDARY_N_DIVIDED_START</code> and <code>POW_BOUNDARY_N_DIVIDED</code> defined for this purpose. When the current difficulty exceeds <code>POW_BOUNDARY_N_DIVIDED_START</code>, every difficulty level will subdivide to <code>POW_BOUNDARY_N_DIVIDED</code> sub-levels. The required hash power increase will only be by <code>1/POW_BOUNDARY_N_DIVIDED</code> of the current hash power. This makes the hash power increase more smoothly in increments.</p><p>The rationale behind this is we changed the method to calculate the target boundary from <code>POW_BOUNDARY_N_DIVIDED_START</code>. When the difficulty is below <code>POW_BOUNDARY_N_DIVIDED_START</code>, we put one more <code>0</code> at the MSB of the target boundary every time we increase the difficulty. On the other hand, if the difficulty exceeds <code>POW_BOUNDARY_N_DIVIDED_START</code>, we put <code>0</code>s at the LSB of the target boundary.</p><p>This process is implemented in the function <code>DifficultyLevelInIntDevided()</code>.</p><p>The graphs below illustrate the benchmarks of the hash power required if <code>POW_BOUNDARY_N_DIVIDED_START</code> is 32 and <code>POW_BOUNDARY_N_DIVIDED_START</code> is 1, 2, 4, 6, and 8.</p><p><img src="../assets/core/features/difficulty-adjustment/image01.png" alt="image01">
<img src="../assets/core/features/difficulty-adjustment/image02.png" alt="image02"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="references"></a>References<a aria-hidden="true" tabindex="-1" class="hash-link" href="#references" title="Direct link to heading">#</a></h2><ol><li><a href="https://mybinder.org/v2/gh/deepgully/jupyter/master?filepath=Zilliqa%2Fdifficulty.ipynb">Difficulty divide</a></li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Zilliqa/dev-portal/docs/core-difficulty-adjustment.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dev-portal/docs/core-pow"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« PoW Algorithm</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dev-portal/docs/core-por"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Proof of Reputation »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#adjustment-procedure" class="table-of-contents__link">Adjustment Procedure</a></li><li><a href="#adjustment-formula-and-parameters" class="table-of-contents__link">Adjustment Formula and Parameters</a></li><li><a href="#difficulty-subdivision" class="table-of-contents__link">Difficulty Subdivision</a></li><li><a href="#references" class="table-of-contents__link">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.zilliqa.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/zilliqa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/invite/BnVzu5W" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://t.me/ZilliqaDevs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/zilliqa" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCvinnFbf0u71cajoxKcfZIQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Zilliqa Research Pte. Ltd.</div></div></div></footer></div>
<script src="/dev-portal/styles.02de1ceb.js"></script>
<script src="/dev-portal/runtime~main.8c9447a9.js"></script>
<script src="/dev-portal/main.4f969add.js"></script>
<script src="/dev-portal/1.4ed8170a.js"></script>
<script src="/dev-portal/2.b4fff381.js"></script>
<script src="/dev-portal/98.5ddf222f.js"></script>
<script src="/dev-portal/99.16543845.js"></script>
<script src="/dev-portal/242c3953.e8f65e58.js"></script>
<script src="/dev-portal/17896441.2c23e411.js"></script>
<script src="/dev-portal/8459df8b.bc0d9ea4.js"></script>
</body>
</html>